<div class="container">
    <div class="input-group mb-3">
        <input id="search-box" type="text" class="form-control" placeholder="Search for an author">
    </div>
    <div id="data-container" class="row"></div>
</div>


<script>
    const datasets = [
        {
            type: "authors",
            url: "{{ site.baseurl }}/data/authors.json"
        }
    ];

    const dataLinks = [];

    $(document).ready(function() {
        datasets.forEach(dataset => {
            siftData(dataset.url, dataset.type, function(data) {
                dataLinks.push({
                    type: dataset.type,
                    data: data
                });
                setTimeout(() => showCategory(), 1000);
            });
        });

        $('#search-box').on('input', function(event) {
            showCategory(event.target.value);
        });
    });

    function siftData(url, dataType, callback) {
        $.getJSON(url, function(data) {
            const temp = [];
            if (dataType === "authors") {
                for (const key in data) {
                    if (data.hasOwnProperty(key)) {
                        temp.push({
                            flavorText: data[key].Author,
                            subtitle: data[key].author_country,
                            link: data[key].author_id
                        });
                    }
                }
            }
            callback(temp);
        });
    }

    function showCategory(filter = "") {
        $('#data-container').html('');
        filter = filter.trim().toLowerCase();

        dataLinks.forEach(element => {
            element.data.forEach(data => {
                if (filter === "" || data.flavorText.toLowerCase().includes(filter)) {
                    appendCard(data);
                }
            });
        });
    }

    function appendCard(data) {
        $('#data-container').append(`
            <div class="card col-4">
                <div class="card-body">
                    <h5 class="card-title">${data.flavorText}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">${data.subtitle}</h6>
                    <a href="#" class="card-link" data-authorid="${data.link}">More</a>
                </div>
            </div>
        `);

        $('.card-link').off('click').on('click', function(event) {
            event.preventDefault();
            const authorId = $(this).data('authorid');
            showAuthorBio(authorId);
        });
    }

    function showAuthorBio(authorId) {
        const url = "{{ site.baseurl }}/data/bios.json";
        $.getJSON(url, function(data) {
            const authorBio = data[authorId];
            if (authorBio) {
                let htmlContent = `
                <div class="col-sm-6">
                <div style="background-color:red; padding-bottom:50%; width:50%; position:sticky; margin-bottom:50%;overflow:auto; :">
                    <h3>${authorBio.Author} is from ${authorBio.Country}.</h3>
                    <h4>${authorBio.Lifespan}</h4>
                    <h4><a href="${authorBio.Wikimedia}">Read More</a></h4>
                    <h5><a href="${authorBio.dloc}">DLOC Resources</a></h5>
                </div>
                </div>
                `;
                $('#data-container').html(htmlContent);
                showAuthorDetails(authorId);
            } else {
                console.error("Author not found in the data.");
            }
        }).fail(function() {
            console.error("Failed to load JSON data.");
        });
    }

    function showAuthorDetails(authorId) {
        const url = "{{ site.baseurl }}/data/publications.json";
        $.getJSON(url, function(data) {
            const authorPublications = data[authorId];
            if (authorPublications) {
                let htmlContent = `<h3 style="float: left; z-index: 1;">Author Details</h3>`;
                authorPublications.forEach(publication => {
                    htmlContent += `
                    <div class="col-sm-6">
                    <div style="background-color: purple;margin-left:50%;width:50%;overflow:auto; ">
                        <ul>
                            <li><strong>Title:</strong> ${publication.Title}</li>
                            <li><strong>Genre:</strong> ${publication.Genre}</li>
                            <li><strong>Language:</strong> ${publication.Language}</a></li>
                            <li><strong>Publisher:</strong> ${publication.Publisher}</li>
                            <li><strong>Publication City:</strong> ${publication.Pub_id}</li>
                            <li><strong>Publication Date:</strong> ${publication.Pubdate}</li>
                            <li><strong>Translation:</strong> ${publication.Translation}</li>
                        </ul>
                        <hr>
                        </div>
                        </div>
                    `;
                });

                $('#data-container').append(htmlContent);
            } else {
                console.error("Publications not found for author.");
            }
        }).fail(function() {
            console.error("Failed to load JSON data.");
        });
    }
</script>
