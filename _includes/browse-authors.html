<!-- Stylesheet-->
<head>
<link rel="stylesheet" type="text/css" href="{{site.baseurl}}/assets/css/includes-style/browse-author-style.css">
</head>


<!-- Main div for Author's Page-->
<div class="container">



    <!-- Search bar -->
    <div class="input-group mb-3">
        <input id="searchInput" type="text" class="form-control searchForm" placeholder="Search for an author">
    </div>


<div class="changeView">
<span><a href="{{site.baseurl}}/authors/">Grid View</a></span>
<span><a href="#" class="interativeTimeline" onclick="displayTimeline()">Timeline View</a></span>
<!--<div class="yearFilterSlider">
    <span>1492</span><input type="range" id="yearFilter" value="1492" min="1492" max="2025"><span>Present</span>
</div>-->
</div>

    <!--Alhpabetically ordered letter navigation bar  -->
    <div class="button-container">
        <button type="button" data-letter="all"><a href="{{site.baseurl}}/authors/">All</a></button>
        <button data-letter="a">A</button>
        <button data-letter="b">B</button>
        <button data-letter="c">C</button>
        <button data-letter="d">D</button>
        <button data-letter="e">E</button>
        <button data-letter="f">F</button>
        <button data-letter="g">G</button>
        <button data-letter="h">H</button>
        <button data-letter="i">I</button>
        <button data-letter="j">J</button>
        <button data-letter="k">K</button>
        <button data-letter="l">L</button>
        <button data-letter="m">M</button>
        <button data-letter="n">N</button>
        <button data-letter="o">O</button>
        <button data-letter="p">P</button>
        <button data-letter="q">Q</button>
        <button data-letter="r">R</button>
        <button data-letter="s">S</button>
        <button data-letter="t">T</button>
        <button data-letter="u">U</button>
        <button data-letter="v">V</button>
        <button data-letter="w">W</button>
        <button data-letter="x">X</button>
        <button data-letter="Y">Y</button>
        <button data-letter="z">Z</button>
</div>



<!-- Where all of the Author's Cards populate-->
<div class="row justify-content-center content">

</div>

<div id="data-container" class="row justify-content-center">

</div>



<!--Pagination bar for Author's Cards -->
<div id="pagination"></div>
</div>


<!-- External javascript for the letter navigation and pagination for Authors-->
<script src="{{site.baseurl}}/az.js"></script>




<!-- Internal javascript dealing with the Author's Bio and Detail functionality-->
<script>

let biosData = {};


$(document).ready(function() {
    
    // Load bios.json once and store it
    $.getJSON("{{ site.baseurl }}/data/bios.json", function(data) {
        biosData = data;
        data.forEach( function(author) {

            console.log(author.Author);

        });
        
    }).fail(function() {
        console.error("Failed to load bios.json");
    });

    $('#search-box').on('input', function(event) {
        showCategory(event.target.value);
    });

    $('.yearFilterSlider').on('change', function(event){

        let filteredYear = document.getElementById("yearFilter").value;

            const data = {
            flavorText: authorBio.Author,
            subtitle: authorBio.Country,
            link: authorBio.authorid
        }

        console.log(`Authors born in the year: ${filteredYear}`);

    if(filteredYear === authorBio.birthYear && link === authorBio.authorid ){
    event.preventDefault();
    appendCard(data);
        }

});



});


/*
//Function to create and display Author's Card based on Author's data
    function showCategory(filter = "") {
        $('#data-container').html('');
        filter = filter.trim().toLowerCase();

        
        dataLinks.forEach(element => {
            element.data.forEach(data => {
                if (filter === "" || data.flavorText.toLowerCase().includes(filter)) {
                  appendCard(data);
}
            });
        });
       
        console.log("This is the showCategory talking here!");
    }

 */

 //Function to create and display Author's Card based on Author's data into the main div 
 //Container

    function appendCard(data) {

        //originallly #data-container not .content
        $('.content').append(`
        <div class="card col-4">
        <div class="card-body">  
       <!-- <h6 class="card-subtitle">${data.subtitle}</h6> -->
       <h6 class="card-title">${data.flavorText}</h6>
        <img id="authorImgCard" src="{{site.baseurl}}/authorphotos/${data.link}.jpg" />
        <a href="#" class="card-link" data-authorid="${data.link}">More Info</a>
         </div>
    </div>
        `);
        console.log("This is the appendCard saying hey!");

        $('.card-link').off('click').on('click', function(event) {
            event.preventDefault();
            const authorId = $(this).data('authorid');
            showAuthorBio(authorId);
        });
}



function displayTimeline () {
    console.log("Hello I am the timeline");

    $('.content').html(`
    <div>{% include horizontal-timeline.html %}</div>
`);
}


//Function that dynamically populates with the author's bio

function showAuthorBio(authorId) {
        const authorBio = biosData[authorId];
if(authorBio){
console.log(`look at me its me authorBio: ${authorId} here!`);
let htmlContent =`
<!--This create the first column div-->

<div class="col" style="position:relative;">

<!-- Creates a container so that the author's profile photo side can scroll independtly of the book details -->
<div class="authorbiodata" style="position: sticky; top: 68px;">
<div height="700px" width="500px">
<h3>${authorBio.Author} </h3>
<div class="authorimg">
<img src="{{site.baseurl}}/authorphotos/${authorBio.authorid}.jpg" />
</div>   
<br>
<div class="authordetails">
<h6> <b>Country of Birth: </b><a href="{{ site.baseurl }}/${authorBio.mapId}/">${authorBio.Country}</a> <br>
    <b>Lifespan:</b> ${authorBio.Lifespan} <br>
    <p><a class="bioResourceLinks" href="${authorBio.Wikimedia}" target="_blank" >Read furthur details on the author's biography <blockquote class="blockquote">sourced from Wikipedia</blockquote></a></p>
    </h6>
</div>
</div>
</div>
</div>

`;

console.log('ShowAuthorBio working here!');
$('.content').html(htmlContent)
showAuthorDetails(authorId);
     }
         else {
    console.error(`Author, ${authorId} not found in the data.`);
      }
                                        
}




/*
function showAuthorBio(authorId) {
       const url = "{{ site.baseurl }}/data/bios.json";
       $.getJSON(url,function(data) {
        const authorBio = data[authorId];
if(authorBio){
console.log(`look at me its me authorBio: ${authorId} here!`);
let htmlContent =`
<!--This create the first column div-->

<div class="col" style="position:relative;">

<!-- Creates a container so that the author's profile photo side can scroll independtly of the book details -->
<div class="authorbiodata" style="position: sticky; top: 68px;">
<div height="700px" width="500px">
<h3>${authorBio.Author} </h3>
<div class="authorimg">
<img src="{{site.baseurl}}/authorphotos/${authorBio.authorid}.jpg" />
</div>   
<br>
<div class="authordetails">
<h6> <b>Country of Birth: </b><a href="{{ site.baseurl }}/${authorBio.mapId}/">${authorBio.Country}</a> <br>
    <b>Lifespan:</b> ${authorBio.Lifespan} <br>
    <b> Biography: </b> <a href="${authorBio.Wikimedia}">Learn More About the Author</a> <br>
    <b> DLOC: </b> <a href="${authorBio.dloc}">Additional Resources</a>
    </h6>
</div>
</div>
</div>
</div>
*/


















//Funciton that dynamically populates the author's book detail
function showAuthorDetails(authorId){
    const url = "{{ site.baseurl }}/data/publocation.json";
 
     $.getJSON(url, function(data){
   //const authorPublications = data[authorId];
   for (const key in data){
   if(data.hasOwnProperty(key)){
    //console.log(`Key: ${key}, Value: ${JSON.stringify(data[key])}`);
   
   if(key === authorId){
    const authorPublications = data[key];
    console.log(`${key} is ${authorId}`);

     
    
if(Array.isArray(authorPublications))
   //if (authorPublications) 
   {
    console.log(`look at me its me authorPublications: ${authorPublications.Title} here!`);
//This will sort the books by Publication date

authorPublications.sort((a,b)=> new Date(a.Pubdate) - new Date(b.Pubdate));
let htmlContent = `<div class="col" >`;

authorPublications.forEach((publication, i) => {

//i variable added to create an index count for the publications by each author

let imgArray = i + 1; 
//console.log(`${key}${imgArray}`);   

htmlContent += `
<!-- For it to fully put in two columns i need to populate this into the div above -->
<div class="books">
    <h3 class="publication_date"><b>Published in ${publication.Pubdate}</b></h3>

            <div id="publicationImageContainer">
            <img class="bookphoto" src="{{site.baseurl}}/bookphotos/${publication.Author}/${key}${imgArray}.jpg" />
            </div>

            <div class="book_details">
            <h4 class="publication_title"><b><i>${publication.Title}</i></b></h4>
           
            <div class="publication_summary">
                <p>${publication.Summary}</p>
              </div>
              <div claass="publication_details"
              <p class="publication_genre">
                <b><a href="{{site.baseurl}}/${publication.Genre}/">${publication.Genre}</a></b>,<b><span>${publication.Sub_Genre}</span></b>
                </p>

                <p class="publication_language"><a href="{{site.baseurl}}/${publication.Language}/">${publication.Language}</a></b></p>
            

              <p class="publication_publisher"><b>${publication.Publisher}</b></p>
            <p class="publication_translation"><b>Translation: ${publication.Translation}</b></p>
             </div>
        </div>
        <p class="publicationResourceLinks">
                <span><a id="Buy" href="${publication.Buy_Link}" target="_blank">Buy</a></span>
                <span>|</span>
                <span><a id="Read" href="${publication.Read_Link}" target="_blank">Read</a></span>
                <span>|</span>
                <span><a id="Listen" href="${publication.Listen_Link}" target="_blank">Listen</a></span>
                </p>
</div>

<hr>
`;
});

htmlContent +=`</div>`;

//originallly #data-container not .content
 $('.content').append(htmlContent);

} 
        
else {
            console.error("Publications not found for author.");
        }
    }
} 
}

}) 
       .fail(function(){
        console.error("Failed to load JSON data.");
       }); 

}

</script>